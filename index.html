<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>H·ªôp Qu√† B√≠ M·∫≠t AR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>

    <style>
      /* N√∫t Nh·∫≠n L√¨ X√¨ (·∫©n l√∫c ƒë·∫ßu) */
      #lixi-btn {
        display: none;
        position: fixed;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        padding: 15px 30px;
        background: #d41414;
        color: #fff;
        font-size: 20px;
        font-weight: bold;
        border: 2px solid #ffcc00;
        border-radius: 50px;
        z-index: 999;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        animation: pulse 1.5s infinite;
      }
      
      @keyframes pulse {
        0% { transform: translateX(-50%) scale(1); }
        50% { transform: translateX(-50%) scale(1.1); }
        100% { transform: translateX(-50%) scale(1); }
      }

      /* M√†n h√¨nh h∆∞·ªõng d·∫´n scan */
      #scanning-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        background: rgba(0,0,0,0.6);
        z-index: 998;
        pointer-events: none;
        font-family: Arial, sans-serif;
      }
    </style>
  </head>
  <body>
    
    <div id="scanning-overlay">H√£y qu√©t v√†o t·∫•m thi·ªáp T·∫øt!</div>
    <button id="lixi-btn" onclick="openLixi()">üßß NH·∫¨N L√å X√å NGAY</button>

    <a-scene 
      mindar-image="imageTargetSrc: ./targets.mind; filterMinCF:0.0001; filterBeta: 0.001;" 
      color-space="sRGB" 
      renderer="colorManagement: true, physicallyCorrectLights" 
      vr-mode-ui="enabled: false" 
      device-orientation-permission-ui="enabled: false">

      <a-assets>
        <a-asset-item id="gift-box-model" src="giftbox.glb"></a-asset-item>
        <a-asset-item id="mascot-model" src="mascot.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="objects: .clickable"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        
        <a-entity id="ar-content" position="0 0 0" scale="0.5 0.5 0.5"> <a-entity id="gift-box" 
            gltf-model="#gift-box-model" 
            position="0 0 0" 
            class="clickable"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear">
          </a-entity>

          <a-entity id="mascot" 
            gltf-model="#mascot-model" 
            position="0 0.5 0" 
            scale="0 0 0" 
            visible="false">
          </a-entity>

          <a-entity id="fireworks" 
            position="0 1 0" 
            particle-system="preset: dust; color: #ffcc00, #ff0000; particleCount: 500; size: 2" 
            visible="false">
          </a-entity>

          <a-plane id="click-trigger" 
             class="clickable"
             position="0 0.2 0" 
             height="1.5" width="1.5" 
             rotation="-90 0 0" 
             material="opacity: 0; transparent: true">
          </a-plane>

        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      const giftBox = document.querySelector('#gift-box');
      const mascot = document.querySelector('#mascot');
      const fireworks = document.querySelector('#fireworks');
      const btn = document.querySelector('#lixi-btn');
      const trigger = document.querySelector('#click-trigger');
      const overlay = document.querySelector('#scanning-overlay');

      // S·ª± ki·ªán khi t√¨m th·∫•y h√¨nh ·∫£nh (Target found)
      const target = document.querySelector('[mindar-image-target]');
      target.addEventListener("targetFound", event => {
        console.log("Target found");
        overlay.style.display = 'none'; // ·∫®n h∆∞·ªõng d·∫´n scan
      });

      target.addEventListener("targetLost", event => {
        console.log("Target lost");
        overlay.style.display = 'flex'; // Hi·ªán l·∫°i h∆∞·ªõng d·∫´n scan
      });

      // X·ª≠ l√Ω khi ch·∫°m v√†o h·ªôp qu√† (th√¥ng qua l·ªõp t√†ng h√¨nh ho·∫∑c tr·ª±c ti·∫øp)
      // H√†m x·ª≠ l√Ω chung
      const onBoxClick = () => {
        if(giftBox.getAttribute('visible') === false) return; // ƒê√£ n·ªï r·ªìi th√¨ th√¥i

        // 1. Gi·∫•u h·ªôp qu√†
        giftBox.setAttribute('visible', 'false');

        // 2. Hi·ªán linh v·∫≠t v√† scale l·ªõn l√™n (hi·ªáu ·ª©ng n·∫£y)
        mascot.setAttribute('visible', 'true');
        mascot.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 1000; easing: easeOutElastic');

        // 3. B·∫Øn ph√°o hoa
        fireworks.setAttribute('visible', 'true');

        // 4. Hi·ªán n√∫t nh·∫≠n l√¨ x√¨ sau 1 gi√¢y
        setTimeout(() => {
            btn.style.display = 'block';
        }, 1000);
      };

      // G√°n s·ª± ki·ªán click
      trigger.addEventListener('click', onBoxClick);
      giftBox.addEventListener('click', onBoxClick);

      // H√†m x·ª≠ l√Ω n√∫t nh·∫≠n ti·ªÅn
      function openLixi() {
        // Thay link Momo ho·∫∑c Zalopay c·ªßa b·∫°n v√†o ƒë√¢y
        window.location.href = 'https://momo.vn/chuyen-tien/...'; 
        // Ho·∫∑c alert("Ch√∫c m·ª´ng nƒÉm m·ªõi!");
      }
    </script>
  </body>
</html>